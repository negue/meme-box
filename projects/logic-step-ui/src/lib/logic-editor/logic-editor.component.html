<mat-tab-group>
  <mat-tab label="Variables">
    <div *ngFor="let variable of logicQueries.nonGlobalVariables$ | async">
      <logic-variable [variable]="variable"></logic-variable>
    </div>

  </mat-tab>
  <mat-tab label="Steps">

    <logic-group [steps]="logicQueries.currentLogicSteps$ | async"
                 [stepTemplate]="stepTemplate" [context]="state"
                 [addActionsTemplate]="actionsTemplate">

    </logic-group>
  </mat-tab>
</mat-tab-group>



<ng-container [ngTemplateOutlet]="editorActionPanelTemplate">

</ng-container>

<ng-template #stepTemplate let-step let-parent="parent" let-context="context">
  <div style="display: inline-block">
  <mat-form-field>
    <mat-label>Variable</mat-label>
    <mat-select [value]="step.stepVariableName"
                #variableNameControl
                (valueChange)="updateStepVariableName(step, variableNameControl.value, parent, context)">
      <ng-container *ngIf="allVariableNames$ | async as variableNameList">
        <mat-option *ngFor="let name of variableNameList"
                    [value]="name">
          {{name}}
        </mat-option>
      </ng-container>
    </mat-select>
  </mat-form-field>

  <mat-form-field>
    <mat-label>Method</mat-label>
    <mat-select [value]="step.methodToCall"
                #methodToCallControl
                (valueChange)="updateMethodToCall(step, methodToCallControl.value, parent, context)">
      <ng-container *ngIf="variableNameControl.value | logicStepMethodList$ | async as methods">
        <mat-option *ngFor="let method of methods"
                    [value]="method.name">
          {{method.name}}
        </mat-option>
      </ng-container>
    </mat-select>
  </mat-form-field>

    <button mat-button (click)="removeStep(step)">Remove</button>

  <br />
  <div *ngIf="step | logicMethodArguments$ | async as methodArguments">
    <div *ngFor="let argument of methodArguments; trackBy: trackByMethodArgument">
      {{argument.name}}: {{argument.typeName}}

      <div *ngIf="argument.typeName === 'time:seconds'">
        <mat-form-field>
          <mat-label>Seconds</mat-label>
          <input matNativeControl #secondsControl type="number"
                 [value]="step.methodArguments[argument.name] || 0"
                 (change)="updateMethodArgument(step, argument.name, secondsControl.value, parent, context)">
        </mat-form-field>

      </div>

      <div *ngIf="argument.typeName === 'callback'">
        <logic-group [steps]="step.callbackSteps[argument.name]"
                     [stepTemplate]="stepTemplate" [context]="getContext(step, argument.name, parent, context)"
                     [addActionsTemplate]="actionsTemplate"></logic-group>
      </div>

    </div>
  </div>

  <br/>
  This would be the step {{ step | json }}
  </div>
</ng-template>

<ng-template #actionsTemplate let-parent="parent" let-context="context">
  <button mat-button (click)="addStep(parent, context)">add step</button>
  <button mat-button (click)="addGroup(parent, context)">add group</button>
</ng-template>
